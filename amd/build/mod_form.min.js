function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("mod_googlemeet/mod_form",["core/notification","core/str","mod_googlemeet/gapi"],function(a,b,c){return{init:function init(d,e,f){var r=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],s="",t="",u="",v="",w="";b.get_strings([{key:"requirednamefield",component:"mod_googlemeet"},{key:"checkweekdays",component:"mod_googlemeet"},{key:"invalideventendtime",component:"mod_googlemeet"},{key:"invalideventenddate",component:"mod_googlemeet"},{key:"timeahead",component:"mod_googlemeet"}]).done(function(a){s=a[0];t=a[1];u=a[2];v=a[3];w=a[4]}).fail(a.exception);var x=document.getElementById("id_generateurlroom"),y=document.getElementById("id_url"),z=document.getElementById("id_url_viewer"),A=document.getElementById("id_originalname"),B=document.getElementById("id_creatoremail"),C=document.querySelector("#region-main .mform");function g(a,b){var c=new FormData(C),d=c.get(a+"[year]"),e=c.get(a+"[month]"),f=c.get(a+"[day]");e=("0"+e).slice(-2);f=("0"+f).slice(-2);if(b){return d+"-"+e+"-"+f}return d+e+f}function h(){var a=new FormData(C),b=a.get("starthour"),c=a.get("startminute"),d=a.get("endhour"),e=a.get("endminute");b=("0"+b).slice(-2);c=("0"+c).slice(-2);d=("0"+d).slice(-2);e=("0"+e).slice(-2);var f=b+":"+c+":00",h=d+":"+e+":00",j=g("eventdate",!0)+" "+f,k=g("eventenddate",!0)+" "+h,l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m=new Date(j),n=new Date(k),o=!1;while(m<=n){if(!o){for(var p=0;p<=l.length;p++){var q=l[m.getDay()],r=a.get("days["+l[p]+"]");if(r&&q===l[p]){o=!0;break}}}m=new Date(m.setDate(m.getDate()+1))}return o}function i(){var a=new FormData(C),b=document.getElementById("id_name"),c=document.getElementById("id_error_name");if(0===a.get("name").trim().length){b.classList.add("is-invalid");b.focus();c.innerText="- "+s;c.style.display="block";return!1}else{b.classList.remove("is-invalid");c.innerText="";c.style.display="none"}var d=document.getElementById("id_googlemeet_eventtime_error"),e=3600*a.get("starthour")+60*a.get("startminute"),f=3600*a.get("endhour")+60*a.get("endminute");if(f<e){d.innerText=u;d.style.display="block";document.getElementById("id_endhour").focus();return!1}else{d.innerText="";d.style.display="none"}var i=Math.floor(new Date(g("eventdate",!0)).getTime()/1e3),j=Math.floor(new Date(g("eventenddate",!0)).getTime()/1e3),k=document.getElementById("id_googlemeet_eventenddategroup_error");if(a.get("addmultiply")&&0!==i&&0!==j&&j<i){k.innerText=v;k.style.display="block";document.getElementById("id_eventenddate_day").focus();return!1}else if(a.get("addmultiply")&&1<Math.ceil((j-i)/31536e3)){k.innerText=w;k.style.display="block";document.getElementById("id_eventenddate_day").focus();return!1}else{k.innerText="";k.style.display="none"}if(a.get("addmultiply")){var l=document.getElementById("id_googlemeet_days_error");if(!h()){l.innerText=t;l.style.display="block";document.getElementById("id_days_Mon").focus();return!1}else{l.innerText="";l.style.display="none"}}return!0}function j(){return k.apply(this,arguments)}function k(){k=_asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:o();if(i()){a.next=3;break}return a.abrupt("return");case 3:a.next=5;return c.auth2.getAuthInstance().signIn({prompt:"select_account"});case 5:p();case 6:case"end":return a.stop();}}},a)}));return k.apply(this,arguments)}function l(a){var b=document.getElementById("generateurlroomLoading");if(a){b.style.display="block";x.disabled=!0}else{b.style.display="none";x.disabled=!1}}function m(a){var b=Math.floor(Math.random()*8888)+1111;return a+" ("+b+")"}function n(a){var b=document.getElementById("googlemeetcontentlog"),c=document.createTextNode(a+"\n");b.style.display="block";b.appendChild(c)}function o(){var a=document.getElementById("googlemeetcontentlog");a.style.display="none";a.innerHTML=""}function p(){return q.apply(this,arguments)}function q(){q=_asyncToGenerator(regeneratorRuntime.mark(function a(){var b,d,e,h,i,j,k,n,o,p,q,r,s,t,u,v,w,D,E,F,G,H;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:b=new FormData(C);d=b.get("starthour");e=b.get("startminute");h=b.get("endhour");i=b.get("endminute");d=("0"+d).slice(-2);e=("0"+e).slice(-2);h=("0"+h).slice(-2);i=("0"+i).slice(-2);j=d+":"+e+":00";k=h+":"+i+":00";n={dateTime:g("eventdate",!0)+"T"+j,timeZone:f};o={dateTime:g("eventdate",!0)+"T"+k,timeZone:f};p=[];if(b.get("addmultiply")){q="INTERVAL="+b.get("period");r="UNTIL="+g("eventenddate",!1)+"T235959Z";s="BYDAY=";t={Sun:"SU",Mon:"MO",Tue:"TU",Wed:"WE",Thu:"TH",Fri:"FR",Sat:"SA"};for(u in t){if(b.get("days["+u+"]")){s+=t[u]+","}}p=["RRULE:FREQ=WEEKLY;"+q+";"+r+";"+s]}v=m(b.get("name"));w={summary:v,description:b.get("introeditor[text]"),start:n,end:o,recurrence:p};l(!0);a.next=20;return c.client.calendar.events.insert({calendarId:"primary",resource:w});case 20:D=a.sent;E=D.result.id;F={conferenceData:{createRequest:{requestId:E}}};a.next=25;return c.client.calendar.events.patch({calendarId:"primary",eventId:E,resource:F,sendNotifications:!1,conferenceDataVersion:1});case 25:G=a.sent;H=G.result;x.remove();A.value=v;y.value=H.hangoutLink;z.value=H.hangoutLink;B.value=H.creator.email;document.getElementById("id_googlemeet_generateurlgroup_error").style.display="none";l(!1);case 34:case"end":return a.stop();}}},a)}));return q.apply(this,arguments)}c.load("client:auth2",function(){c.client.init({apiKey:e,clientId:d,discoveryDocs:r,scope:"https://www.googleapis.com/auth/calendar.events"}).then(function(){x.onclick=j;x.disabled=!1}).catch(function(a){x.disabled=!0;n(JSON.stringify(a,null,2))})})}}});
//# sourceMappingURL=mod_form.min.js.map
