define(["core/notification","core/str"],function(a,b){return{init:function(c,d,e){function f(){gapi.load("client:auth2",g)}function g(){gapi.client.init({apiKey:d,clientId:c,discoveryDocs:m,scope:e}).then(function(){gapi.auth2.getAuthInstance().signOut(),n.onclick=h},function(a){n.disabled=!0,j(),i(JSON.stringify(a,null,2))})}function h(){var c=new FormData(q),d=document.getElementById("id_name"),e=document.getElementById("id_error_name");return 0===c.get("name").trim().length?(d.classList.add("is-invalid"),d.focus(),void b.get_string("requiredfield","mod_googlemeet").done(function(a){e.innerText="- "+a}).fail(a.exception)):(d.classList.remove("is-invalid"),e.innerText="",void gapi.auth2.getAuthInstance().signIn({prompt:"select_account"}).then(function(){l()}))}function i(a){var b=document.getElementById("googlemeetlog");b.setAttribute("open",!0);var c=document.getElementById("googlemeetcontentlog"),d=document.createTextNode(a+"\n");c.appendChild(d)}function j(){var a=document.getElementById("googlemeetcontentlog");a.innerText=""}function k(){var a=["id_url","id_timeopen_enabled","id_timeopen_day","id_timeopen_month","id_timeopen_year","id_timeopen_hour","id_timeopen_minute","id_timeopen_calendar","id_timeclose_enabled","id_timeclose_day","id_timeclose_month","id_timeclose_year","id_timeclose_hour","id_timeclose_minute","id_timeclose_calendar","id_generateLink"];a.forEach(function(a){var b=document.getElementById(a);return"checkbox"===b.getAttribute("type")?void(b.parentElement.style.display="none"):(b.setAttribute("readonly",!0),b.style.pointerEvents="none",b.style.touchAction="none",b.setAttribute("tabindex","-1"),void b.setAttribute("aria-disabled",!0))})}function l(){var c=new FormData(q),d=new Date,e={},f={};e=c.get("timeopen[enabled]")?{dateTime:c.get("timeopen[year]")+"-"+c.get("timeopen[month]")+"-"+c.get("timeopen[day]")+"T"+c.get("timeopen[hour]")+":"+c.get("timeopen[minute]")+":00"+c.get("timezoneoffset"),timezone:c.get("timezone")}:{date:d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()},f=c.get("timeclose[enabled]")?{dateTime:c.get("timeclose[year]")+"-"+c.get("timeclose[month]")+"-"+c.get("timeclose[day]")+"T"+c.get("timeclose[hour]")+":"+c.get("timeclose[minute]")+":00"+c.get("timezoneoffset"),timezone:c.get("timezone")}:{date:d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()},j(),b.get_string("creatingcalendarevent","mod_googlemeet").done(function(a){i(a)}).fail(a.exception);var g={summary:c.get("name"),description:c.get("introeditor[text]"),start:e,end:f},h=gapi.client.calendar.events.insert({calendarId:"primary",resource:g});h.execute(function(c){b.get_strings([{key:"eventsuccessfullycreated",component:"mod_googlemeet"},{key:"creatingconferenceroom",component:"mod_googlemeet"}]).done(function(a){i("   "+a[0]+": "+c.creator.email),i(a[1])}).fail(a.exception);var d={conferenceData:{createRequest:{requestId:c.id}}};gapi.client.calendar.events.patch({calendarId:"primary",eventId:c.id,resource:d,sendNotifications:!1,conferenceDataVersion:1}).execute(function(c){b.get_string("conferencesuccessfullycreated","mod_googlemeet").done(function(a){i("   "+a+": "+c.hangoutLink)}).fail(a.exception),o.value=c.hangoutLink,o.focus(),o.classList.remove("is-invalid"),p.innerText="",k()})})}var m=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],n=document.getElementById("id_generateLink"),o=document.getElementById("id_url"),p=document.getElementById("id_error_url"),q=document.querySelector("#region-main .mform");window.addEventListener("load",f(),!1)}}});